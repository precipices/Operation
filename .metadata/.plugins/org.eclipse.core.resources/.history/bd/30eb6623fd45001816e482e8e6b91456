package temp;

import java.util.Vector;

import javax.swing.ImageIcon;
import javax.swing.JFrame;
import javax.swing.JOptionPane;

import com.operation.client.MainFrame;
import com.operation.common.Message;
import com.operation.common.Operation;
import com.operation.common.Worker;
import com.operation.rpc.RPCHelper;

public class Test {
	public static void main(String[] args) {
		RPCHelper helper = null;
		Worker worker = null;
		JFrame myFrame = null;

		helper = new RPCHelper();
		helper.login("w0001", "123");
		worker = helper.selectWorkerById("w0001");
		myFrame = new MainFrame(helper, worker);
		Vector<Message> messages = helper.getMessage();
		if (messages.size() == 0) {
			System.out.println("没有信息");
		}
		String mes = null;
		ImageIcon imageIcon = new ImageIcon("./imgs/1.jpg");
		Object[] options = { "授受", "拒绝" };
		for (Message m : messages) {
			int type = m.getMessageType();
			// 得到信息
			Operation op = helper.selectOperationById(m.getOperationId());
			String operationName = op.getName();
			Worker fromWorker = helper.selectWorkerById(m.getFromId());
			int choose=0;
			switch (type) {
			case Message.CHOOSE:
				mes = "医生[" + fromWorker.getName() + "]邀请你参与手术[" + operationName + "]!";
				// 打开消息窗口
				choose = JOptionPane.showOptionDialog(myFrame, mes, "手术邀请", JOptionPane.DEFAULT_OPTION,
						JOptionPane.WARNING_MESSAGE, imageIcon, options, options[0]);
				if(choose==0) {//授受
					helper.sendMessage(m.getFromId(), m.getOperationId(), Message.ACCEPT);
				}else if(choose==1) {//拒绝
					helper.sendMessage(m.getFromId(), m.getOperationId(), Message.REFUSE);
				}
				break;
			case Message.ACCEPT:
				mes = fromWorker.getPosition() + "[" + fromWorker.getName() + "]授受了你的[" + operationName + "]手术邀请!";
				// 打开消息窗口
				JOptionPane.showMessageDialog(myFrame, mes);
				break;
			case Message.REFUSE:
				mes = fromWorker.getPosition() + "[" + fromWorker.getName() + "拒绝了你的[" + operationName + "]手术邀请!";
				// 打开消息窗口
				JOptionPane.showMessageDialog(myFrame, mes);
				/**
				 * 这里写自动分配员工代码
				 */
				break;
			}
			// 处理完后移除该消息
			helper.removeMessage(m);
		}
		
		
		
		
		
		
		
	}
}
